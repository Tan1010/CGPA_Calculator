<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <link rel="icon" type="image/x-icon" href="images/favicon.png">
    <style>
        body {
            margin-left:20px;
            margin-right:20px;
        }

        #question_mark{
            cursor: pointer;
        }

        #grade_table, #grade_table td, #grade_table th{
            border: 1px solid black;
            border-collapse: collapse;
            padding: 5px;
        }

        rect {
            color: transparent;
            width: 100%;
            height: 100%;
            stroke-width: 5px;
            opacity: 0.5
        }

    </style>
    <title>CGPA Calculator</title>
</head>
<body>
    <h1 class="text-center">CGPA Calculator</h1>
    <div class="alert alert-primary alert-dismissible" role="alert">
        <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
        The calculated CGPA is only for reference.
    </div>
    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item">
          <a class="nav-link active" id="calculate-cgpa-tab" data-toggle="tab" href="#calculate_cgpa" role="tab" aria-controls="calculate_cgpa" aria-selected="true">Calculate CGPA</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="show-targeted-cgpa-possibility-tab" data-toggle="tab" href="#show_targeted_cgpa_possibility" role="tab" aria-controls="show_targeted_cgpa_possibility" aria-selected="false">Show Targeted CGPA Possibility</a>
        </li>
    </ul>
    
    <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="calculate_cgpa" role="tabpanel" aria-labelledby="calculate-cgpa-tab">
            <form id="form">
                <h3 class="p-3 mb-2 bg-light text-dark">Previous Semesters <i>(Up till last semester)</i></h3>
                <table id="previous_sem_table">
                    <tr>
                        <th>Total Credits</th>
                        <th>CGPA</th>
                    </tr>
                    <tr>
                        <td><input type="number" step="1" id="prev_sem_credits"></td>
                        <td><input type="number" step="0.01" id="prev_sem_cgpa" max="4" min="0"></td>
                    </tr>
                </table>
                
                <br>
                <h3 class="p-3 mb-2 bg-light text-dark">Current Semester</h3>
                <table id="table">
                    <tr>
                        <th>Credits</th>
                        <th>Grade <svg id="question_mark" onclick="showGradingScheme()" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-question-circle" viewBox="0 0 16 16">
                            <rect class="tooltiptext">
                                <title>Show grading scheme</title>
                            </rect>
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                            <path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"/>
                        </svg>
                        </th>
                    </tr>
                    <tr>
                        <td><input type="number" class="credit" min="1" max="15" required></td>
                        <td><input type="text" class="grade" pattern="[a-zA-Z+-]+" required></td>
                    </tr>
                    <tr>
                        <td><input type="number" class="credit" min="1" max="15" required></td>
                        <td><input type="text" class="grade" pattern="[a-zA-Z+-]+" required></td>
                    </tr>
                    <tr>
                        <td><input type="number" class="credit" min="1" max="15" required></td>
                        <td><input type="text" class="grade" pattern="[a-zA-Z+-]+" required></td>
                    </tr>
                    <tr>
                        <td><input type="number" class="credit" min="1" max="15" required></td>
                        <td><input type="text" class="grade" pattern="[a-zA-Z+-]+" required></td>
                    </tr>
                    <tr>
                        <td><input type="number" class="credit" min="1" max="15" required></td>
                        <td><input type="text" class="grade" pattern="[a-zA-Z+-]+" required></td>
                    </tr>
                </table>
                
                <button class="btn btn-secondary" id="add_row_button" onclick="addRow()">Add Row</button>
                <button class="btn btn-danger" id="delete_row_button" onclick="deleteRow()">Delete Row</button>
                <input class="btn btn-primary" type="submit" value="Calculate">
            </form>
            <div id="result"></div>
        </div>

        <!-- Targeted CGPA -->
        <div class="tab-pane fade" id="show_targeted_cgpa_possibility" role="tabpanel" aria-labelledby="show-targeted-cgpa-possibility-tab">
            <form id="targeted_cgpa_form">
                <h3 class="p-3 mb-2 bg-light text-dark">Previous Semesters <i>(Up till last semester)</i></h3>
                <table id="targeted_cgpa_previous_sem_table">
                    <tr>
                        <th>Total Credits</th>
                        <th>CGPA</th>
                    </tr>
                    <tr>
                        <td><input type="number" step="1" id="targeted_prev_sem_credits"></td>
                        <td><input type="number" step="0.01" id="targeted_prev_sem_cgpa" max="4" min="0"></td>
                    </tr>
                </table>

                <br>
                
                <h3 class="p-3 mb-2 bg-light text-dark">Current Semester</h3>
                <table id="targeted_cgpa_table">
                    <tr>
                        <th>Credits</th>
                    </tr>
                    <tr>
                        <td><input type="number" class="targeted_cgpa_credit" min="1" max="15" required></td>
                    </tr>
                    <tr>
                        <td><input type="number" class="targeted_cgpa_credit" min="1" max="15" required></td>
                    </tr>
                    <tr>
                        <td><input type="number" class="targeted_cgpa_credit" min="1" max="15" required></td>
                    </tr>
                    <tr>
                        <td><input type="number" class="targeted_cgpa_credit" min="1" max="15" required></td>
                    </tr>
                    <tr>
                        <td><input type="number" class="targeted_cgpa_credit" min="1" max="15" required></td>
                    </tr>
                </table>
               
                <button class="btn btn-secondary" id="targeted_cgpa_add_row_button" onclick="addRowTargetedCGPA()">Add Row</button>
                <button class="btn btn-danger" id="targeted_cgpa_delete_row_button" onclick="deleteRowTargetedCGPA()">Delete Row</button>
                <br>
                <label for="targeted_cgpa">Targeted CGPA: </label>
                <input type="number" step="0.01" id="targeted_cgpa" max="4" min="0" required>
                <input class="btn btn-primary" type="submit" value="Find">
            </form>
            <div id="targeted_cgpa_result"></div>
        </div>
    </div>

    
    <!-- Modal -->
    <div class="modal fade" id="modal_delete_row" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Deletion Error</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            </div>
            <div class="modal-body">
                Cannot delete the last row. 
            </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-light" data-dismiss="modal">Close</button>
            </div>
        </div>
        </div>
    </div>

    <!-- Show CGPA Modal -->
    <div class="modal fade" id="modal_show_cgpa" tabindex="-1" role="dialog" aria-labelledby="showCGPAModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
            <h5 class="modal-title" id="showCGPAModalLabel">CGPA</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            </div>
            <div class="modal-body" id="show_cgpa_div">
                
            </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-light" data-dismiss="modal">Close</button>
            </div>
        </div>
        </div>
    </div>

    <!-- Show CGPA Possibility Modal -->
    <div class="modal fade" id="modal_show_cgpa_possibility" tabindex="-1" role="dialog" aria-labelledby="showCGPAPossibilityModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
            <h5 class="modal-title" id="showCGPAPossibilityModalLabel">CGPA Possibility</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            </div>
            <div class="modal-body" id="show_cgpa_possibility_div">
                
            </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-light" data-dismiss="modal">Close</button>
            </div>
        </div>
        </div>
    </div>

    <!-- Wrong Grade Modal -->
    <div class="modal fade" id="modal_wrong_grade" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Grade Error</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            </div>
            <div class="modal-body">
                Please insert the correct grade. 
            </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-light" data-dismiss="modal">Close</button>
            </div>
        </div>
        </div>
    </div>

    <!-- Grading Scheme Modal -->
    <div class="modal fade" id="modal_grading_scheme" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Grading Scheme</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            </div>
            <div class="modal-body">
                <table id="grade_table">
                    <tr>
                        <th>Grade</th>
                        <th>Grade Point</th>
                        <th>Interpretation</th>
                    </tr>
                    <tr>
                        <td>A+</td>
                        <td>4.0</td>
                        <td>Distinction</td>
                    </tr>
                    <tr>
                        <td>A</td>
                        <td>4.0</td>
                        <td>Distinction</td>
                    </tr>
                    <tr>
                        <td>A-</td>
                        <td>3.7</td>
                        <td>Distinction</td>
                    </tr>
                    <tr>
                        <td>B+</td>
                        <td>3.3</td>
                        <td>Good</td>
                    </tr>
                    <tr>
                        <td>B</td>
                        <td>3.0</td>
                        <td>Good</td>
                    </tr>
                    <tr>
                        <td>B-</td>
                        <td>2.7</td>
                        <td>Good</td>
                    </tr>
                    <tr>
                        <td>C+</td>
                        <td>2.3</td>
                        <td>Pass</td>
                    </tr>
                    <tr>
                        <td>C</td>
                        <td>2.0</td>
                        <td>Pass</td>
                    </tr>
                    <tr>
                        <td>C-</td>
                        <td>1.7</td>
                        <td>Fail</td>
                    </tr>
                    <tr>
                        <td>D+</td>
                        <td>1.3</td>
                        <td>Fail</td>
                    </tr>
                    <tr>
                        <td>D</td>
                        <td>1.0</td>
                        <td>Fail</td>
                    </tr>
                    <tr>
                        <td>F</td>
                        <td>0.0</td>
                        <td>Fail</td>
                    </tr>
                </table>
            </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-light" data-dismiss="modal">Close</button>
            </div>
        </div>
        </div>
    </div>
    <script>
        const grades_dict = {
            'A+': 4.0,
            'A': 4.0,
            'A-': 3.7,
            'B+': 3.3,
            'B': 3.0,
            'B-': 2.7,
            'C+': 2.3,
            'C': 2.0,
            'C-': 1.7,
            'D+': 1.3,
            'D': 1.0,
            'F': 0.0,
        }

        const g_point = [4.0, 3.7, 3.3, 3.0, 2.7, 2.3, 2.0, 1.7, 1.3, 1.0, 0.0];

        document.getElementById("form").onsubmit = function(event){
            event.preventDefault();
            calculate();
        }

        document.getElementById("targeted_cgpa_form").onsubmit = function(event){
            event.preventDefault();
            findPossibility();
        }

        function showGradingScheme(){
            $('#modal_grading_scheme').modal();
        }

        function addRow() {
            var table = document.getElementById("table");
            var row = table.insertRow(-1);
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            cell1.innerHTML = '<td><input type="number" class="credit" min="1" max="15" required></td>';
            cell2.innerHTML = '<td><input type="text" class="grade" pattern="[a-zA-Z+-]+" required></td>';
            event.preventDefault();
        }

        function addRowTargetedCGPA() {
            var table = document.getElementById("targeted_cgpa_table");
            var row = table.insertRow(-1);
            var cell1 = row.insertCell(0);
            cell1.innerHTML = '<td><input type="number" class="targeted_cgpa_credit" min="1" max="15" required></td>';
            event.preventDefault();
        }

        function deleteRow() {
            event.preventDefault();
            if(document.getElementById("table").rows.length > 2){
                document.getElementById("table").deleteRow(-1);
            }
            else{
                $("#modal_delete_row").modal();
            }
        }

        function deleteRowTargetedCGPA() {
            event.preventDefault();
            if(document.getElementById("targeted_cgpa_table").rows.length > 2){
                document.getElementById("targeted_cgpa_table").deleteRow(-1);
            }
            else{
                $("#modal_delete_row").modal();
            }
        }

        function calculate(){
            var total_grade_point = 0;
            var total_credit = 0
            var credits = document.getElementsByClassName('credit');
            var grades = document.getElementsByClassName('grade');
            var pre_cgpa = document.getElementById('prev_sem_cgpa').value;
            var pre_credits = document.getElementById('prev_sem_credits').value;
            var pre_grade_point = parseFloat(parseFloat(pre_cgpa) * parseFloat(pre_credits)).toFixed(1);
            var possible_pre_grade_point_1 = parseFloat(parseFloat(pre_grade_point) - 0.1).toFixed(1);
            var possible_pre_grade_point_2 = parseFloat(parseFloat(pre_grade_point)).toFixed(1);
            var possible_pre_grade_point_3 = parseFloat(parseFloat(pre_grade_point) + 0.1).toFixed(1);
            var num_A = 0;
            var num_sub = 0;
            var result_div = document.getElementById('result');
            var temp_grade;
            for (let i = 0; i < credits.length; i++) {
                if(credits[i].value && grades[i].value){
                    num_sub += 1;
                    if (grades[i].value.length >1){
                        temp_grade = grades[i].value[0].toUpperCase() + grades[i].value[1].toUpperCase();
                    }
                    else{
                        temp_grade = grades[i].value.toUpperCase();
                    }

                    if(!(temp_grade in grades_dict)){
                        $("#modal_wrong_grade").modal();
                        return;
                    }

                    grades[i].value = temp_grade;

                    if(parseFloat(grades_dict[grades[i].value]) == 4.0){
                        num_A+=1;
                    }
                    
                    grade_point = parseFloat(credits[i].value) * parseFloat(grades_dict[grades[i].value]);
                    total_grade_point += parseFloat(grade_point);
                    total_credit += parseFloat(credits[i].value);  
                }
            }
            
            if(pre_cgpa=='' || pre_credits==''){
                var cgpa = parseFloat(total_grade_point / total_credit).toFixed(2)
                $('#modal_show_cgpa').modal();
                document.getElementById('show_cgpa_div').innerHTML = '<p>Your possible CGPA: <b>'+ cgpa +' / 4.00</b></p>';
                return;
            }

            if (parseFloat(pre_cgpa) == 4 && num_A == num_sub){
                $('#modal_show_cgpa').modal();
                document.getElementById('show_cgpa_div').innerHTML = '<p>Your possible CGPA: <b>4.00 / 4.00</b></p>';
                return;
            }


            var cgpa1 = parseFloat((parseFloat(possible_pre_grade_point_1)+parseFloat(total_grade_point))/(parseFloat(pre_credits)+parseFloat(total_credit))).toFixed(2);
            var cgpa2 = parseFloat((parseFloat(possible_pre_grade_point_2)+parseFloat(total_grade_point))/(parseFloat(pre_credits)+parseFloat(total_credit))).toFixed(2);
            var cgpa3 = parseFloat((parseFloat(possible_pre_grade_point_3)+parseFloat(total_grade_point))/(parseFloat(pre_credits)+parseFloat(total_credit))).toFixed(2);

            if (cgpa1 > 4.0){
                cgpa1 = 4.0
            }
            if (cgpa2 > 4.0){
                cgpa2 = 4.0
            }
            if (cgpa3 > 4.0){
                cgpa3 = 4.0
            }
            

            if(cgpa1 == cgpa2 && cgpa1 == cgpa3){
                $('#modal_show_cgpa').modal();
                document.getElementById('show_cgpa_div').innerHTML = '<p>Your possible CGPA: <b>'+cgpa1+' / 4.00</b></p>';
                return;
            }
            else{
                $('#modal_show_cgpa').modal();
                if(cgpa1 == cgpa2){
                    document.getElementById('show_cgpa_div').innerHTML = '<p>Your possible CGPA: <b>'+cgpa1 +' / 4.00 or '+ cgpa3+' / 4.00</b></p>';
                }
                else if(cgpa1 == cgpa3 || cgpa2 == cgpa3){
                    document.getElementById('show_cgpa_div').innerHTML = '<p>Your possible CGPA: <b>'+cgpa1 +' / 4.00 or '+ cgpa2+' / 4.00</b></p>';
                }
                else{
                    document.getElementById('show_cgpa_div').innerHTML = '<p>Your possible CGPA: <b>'+cgpa1 +' / 4.00 or '+ cgpa2 +' / 4.00 or '+ cgpa3 +' / 4.00</b></p>';
                }
            }
            
        }

        function findPossibility(){
            var targeted_prev_sem_credits = document.getElementById('targeted_prev_sem_credits').value;
            var targeted_prev_sem_cgpa = document.getElementById('targeted_prev_sem_cgpa').value;
            var targeted_cgpa_credit = document.getElementsByClassName('targeted_cgpa_credit');
            var targeted_cgpa = document.getElementById('targeted_cgpa').value;

            var previous_grade_points = parseFloat(parseFloat(targeted_prev_sem_credits) * parseFloat(targeted_prev_sem_cgpa)).toFixed(1);
            var previous_grade_points_1 = parseFloat(previous_grade_points) - 0.1;
            var previous_grade_points_2 = parseFloat(previous_grade_points);
            var previous_grade_points_3 = parseFloat(previous_grade_points) + 0.1;
            var targeted_cgpa_result_div = document.getElementById('targeted_cgpa_result');

            var total_credits = parseFloat(targeted_prev_sem_credits);
            var current_sem_credits =  [];
            for (let i = 0; i < targeted_cgpa_credit.length; i++) {
                if(targeted_cgpa_credit[i].value){
                    current_sem_credits[i] = parseFloat(targeted_cgpa_credit[i].value);
                    total_credits += parseFloat(targeted_cgpa_credit[i].value);
                }
            }
            current_sem_credits.sort();
            var current_sem_credits_counts = {};
            current_sem_credits.forEach(function(n) {
                current_sem_credits_counts[n] = current_sem_credits_counts[n] || 0;
                current_sem_credits_counts[n]++;
            });
            
            var total_needed_grade_points = parseFloat(parseFloat(total_credits) * parseFloat(targeted_cgpa));
            var additional_needed_grade_points = [];
            additional_needed_grade_points[0] = parseFloat(total_needed_grade_points - previous_grade_points_1).toFixed(1);
            additional_needed_grade_points[1] = parseFloat(total_needed_grade_points - previous_grade_points_2).toFixed(1);
            additional_needed_grade_points[2] = parseFloat(total_needed_grade_points - previous_grade_points_3).toFixed(1);

            var possible_maximum_grade_points = 0;
            for(let i=0; i < current_sem_credits.length; i++){
                possible_maximum_grade_points+= parseFloat(current_sem_credits[i]) * 4.00;
            }

            $('#modal_show_cgpa_possibility').modal();
            if(possible_maximum_grade_points>=additional_needed_grade_points[0] ||  possible_maximum_grade_points>=additional_needed_grade_points[1] || possible_maximum_grade_points>=additional_needed_grade_points[2]){
                document.getElementById('show_cgpa_possibility_div').innerHTML = '<p>It is <b>possible</b> to get <b>'+ parseFloat(targeted_cgpa).toFixed(2) +' / 4.00</b>.</p>';
                // targeted_cgpa_result_div.innerHTML='<p>It is <b>possible</b> to get <b>'+ parseFloat(targeted_cgpa).toFixed(2) +' / 4.00</b>.</p>';
            }
            else{
                document.getElementById('show_cgpa_possibility_div').innerHTML = '<p>Unfortunately, it is <b>not possible</b> to get <b>'+ parseFloat(targeted_cgpa).toFixed(2) +' / 4.00</b>.</p>';
                // targeted_cgpa_result_div.innerHTML='<p>Unfortunately, it is <b>not possible</b> to get <b>'+ parseFloat(targeted_cgpa).toFixed(2) +' / 4.00</b>.</p>';
            }
        }

    </script>
</body>
</html>